<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PyAssistant - Python编程智能助手</title>
    <link href="{{ url_for('static', filename='pyassistant.png') }}" rel="icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/atom-one-dark.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous">
    <link href="{{ url_for('static', filename='style.css') }}" rel="stylesheet">
</head>
<body>
    <!-- 移动端顶部栏 -->
    <div class="mobile-header">
        <div class="mobile-menu-toggle" id="mobileMenuToggle">
            <i class="fas fa-bars"></i>
        </div>
        <div class="mobile-logo">
            <i class="fas fa-code"></i>
            <span>PyAssistant</span>
        </div>
        <div class="mobile-actions">
            <button class="mobile-action-btn" id="mobileNewChat">
                <i class="fas fa-plus"></i>
            </button>
        </div>
    </div>

    <div class="app-container">
        <!-- 侧边栏 -->
        <div class="sidebar" id="sidebar">
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-code"></i>
                </div>
                <div class="logo-text">PyAssistant</div>
            </div>

            <div class="nav-section">
                <div class="nav-title">主要功能</div>
                <div class="nav-item active" data-tab="chat">
                    <i class="fas fa-comments"></i>
                    <span>对话助手</span>
                </div>
                <div class="nav-item" data-tab="tools">
                    <i class="fas fa-tools"></i>
                    <span>代码工具</span>
                </div>
                <div class="nav-item" data-tab="documentation">
                    <i class="fas fa-book"></i>
                    <span>文档查询</span>
                </div>
                <div class="nav-item" data-tab="crawler">
                    <i class="fas fa-spider"></i>
                    <span>Python爬虫</span>
                </div>
            </div>

            <div class="history-section">
                <div class="nav-title">
                    对话历史
                    <button class="refresh-history-btn" id="refreshHistory" title="刷新历史记录">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                </div>
                <div id="historyList">
                    <!-- 历史记录将通过JavaScript动态加载 -->
                </div>
            </div>
        </div>

        <!-- 主内容区域 -->
        <div class="main-content">
            <div class="header">
                <div class="header-title">Python编程助手</div>
                <div class="header-actions">
                    <div class="user-info" id="userInfoHeader" style="display: none;">
                        <span class="user-name" id="userNameHeader"></span>
                        <button class="btn btn-outline btn-sm" id="logoutBtnHeader">登出</button>
                    </div>
                    <button class="btn btn-outline" id="themeToggle">
                        <i class="fas fa-sun"></i>
                        <span id="themeText">浅色主题</span>
                    </button>
                    <button class="btn btn-outline" id="clearChat">
                        <i class="fas fa-trash"></i>
                        清除对话
                    </button>
                    <button class="btn btn-primary" id="newChat">
                        <i class="fas fa-plus"></i>
                        新建对话
                    </button>
                </div>
            </div>

            <!-- 语音识别状态显示 -->
            <div class="voice-status" id="voiceStatus" style="display: none;">
                <div class="voice-recording">
                    <i class="fas fa-microphone recording-pulse"></i>
                    <span>正在录音... 点击停止</span>
                </div>
            </div>

            <!-- 聊天界面 -->
            <div class="chat-container" id="chatTab">
                <div class="chat-messages" id="chatMessages">
                    {% if logged_in and chat_history %}
                        <!-- 如果有对话历史，显示历史消息 -->
                        {% for msg in chat_history %}
                            <div class="message {{ msg.role }}">
                                <div class="message-avatar">
                                    <i class="fas {% if msg.role == 'user' %}fa-user{% elif msg.role == 'assistant' %}fa-robot{% else %}fa-info-circle{% endif %}"></i>
                                </div>
                                <div class="message-content">
                                    {% if msg.role == 'assistant' %}
                                    <div class="message-header">
                                        <div class="message-actions">
                                            <button class="copy-btn" title="复制整个回答">
                                                <i class="fas fa-copy"></i>
                                                <span class="btn-text">复制</span>
                                            </button>
                                        </div>
                                    </div>
                                    {% endif %}
                                    <div class="message-text">
                                        {% if msg.type == 'html' %}
                                            {{ msg.message|unescape|safe }}
                                        {% else %}
                                            {{ msg.message|unescape|replace('\n', '<br>')|safe }}
                                        {% endif %}
                                    </div>
                                    <div class="message-time">{{ msg.timestamp }}</div>
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <!-- 欢迎消息 -->
                        <div class="welcome-message">
                        <div class="welcome-icon">
                            <i class="fas fa-robot"></i>
                        </div>
                        <div class="welcome-title">欢迎使用 Python 编程助手</div>
                        <div class="welcome-subtitle">我可以帮助您解决各种 Python 编程问题</div>
                        <div class="feature-list">
                            <div class="feature-item">
                                <i class="fas fa-code"></i>
                                <span>代码调试</span>
                            </div>
                            <div class="feature-item">
                                <i class="fas fa-book"></i>
                                <span>文档查询</span>
                            </div>
                            <div class="feature-item">
                                <i class="fas fa-bug"></i>
                                <span>错误修复</span>
                            </div>
                            <div class="feature-item">
                                <i class="fas fa-rocket"></i>
                                <span>性能优化</span>
                            </div>
                            <div class="feature-item">
                                <i class="fas fa-microphone"></i>
                                <span>语音输入</span>
                            </div>
                            <div class="feature-item">
                                <i class="fas fa-image"></i>
                                <span>图像上传</span>
                            </div>
                            <div class="feature-item">
                                <i class="fas fa-palette"></i>
                                <span>主题切换</span>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </div>

                <div class="input-container">
                    <div class="input-box">
                        <textarea class="input-field" id="questionInput" placeholder="输入您的Python编程问题..."></textarea>
                        <div class="input-buttons">
                            <button class="voice-btn" id="voiceButton" title="语音输入">
                                <i class="fas fa-microphone"></i>
                            </button>
                            <button class="send-btn" id="sendButton">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                    <div class="input-actions">
                        <button class="action-btn" id="insertCode">
                            <i class="fas fa-code"></i>
                            插入代码
                        </button>
                        <button class="action-btn" id="exampleQuestions">
                            <i class="fas fa-question-circle"></i>
                            示例问题
                        </button>
                        <button class="action-btn" id="syntaxCheck">
                            <i class="fas fa-check-circle"></i>
                            语法检查
                        </button>
                        <button class="action-btn" id="executeCode">
                            <i class="fas fa-play"></i>
                            执行代码
                        </button>
                        <button class="action-btn" id="voiceInput">
                            <i class="fas fa-microphone"></i>
                            语音输入
                        </button>
                        <button class="action-btn" id="imageUploadBtn">
                            <i class="fas fa-image"></i>
                            上传图像
                        </button>
                    </div>
                </div>
            </div>

            <!-- 工具界面 -->
            <div class="tools-container" id="toolsTab" style="display: none;">
                <div class="tools-grid">
                    <div class="tool-card" data-tool="syntax">
                        <div class="tool-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <h3>语法检查</h3>
                        <p>检查Python代码的语法正确性，识别语法错误并提供修复建议</p>
                        <textarea class="tool-input" placeholder="输入要检查的Python代码..." id="syntaxInput"></textarea>
                        <button class="tool-button" id="syntaxCheckBtn">
                            <i class="fas fa-check"></i>
                            检查语法
                        </button>
                    </div>

                    <div class="tool-card" data-tool="execute">
                        <div class="tool-icon">
                            <i class="fas fa-play"></i>
                        </div>
                        <h3>代码执行</h3>
                        <p>安全地执行Python代码片段并查看输出结果</p>
                        <textarea class="tool-input" placeholder="输入要执行的Python代码..." id="executeInput"></textarea>
                        <button class="tool-button" id="executeCodeBtn">
                            <i class="fas fa-play"></i>
                            执行代码
                        </button>
                    </div>

                    <div class="tool-card" data-tool="analyze">
                        <div class="tool-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <h3>代码分析</h3>
                        <p>分析代码质量，提供改进建议和最佳实践</p>
                        <textarea class="tool-input" placeholder="输入要分析的Python代码..." id="analyzeInput"></textarea>
                        <button class="tool-button" id="analyzeCodeBtn">
                            <i class="fas fa-search"></i>
                            分析代码
                        </button>
                    </div>
                </div>
            </div>

            <!-- Python爬虫界面 -->
            <div class="crawler-container" id="crawlerTab" style="display: none;">
                <div class="crawler-header">
                    <h2><i class="fas fa-spider"></i> Python网页爬虫</h2>
                    <p>使用Firecrawl API快速抓取网页内容并转换为Markdown格式</p>
                </div>
                
                <div class="crawler-controls">
                    <div class="url-input-group">
                        <label for="urlInput">目标网址：</label>
                        <input type="url" class="url-input" id="urlInput" 
                               placeholder="请输入要爬取的网址（如：https://example.com）" required>
                        <button class="crawler-button" id="startCrawlerBtn">
                            <i class="fas fa-spider"></i>
                            开始爬取
                        </button>
                    </div>
                </div>

                <div class="crawler-results" id="crawlerResults" style="display: none;">
                    <div class="results-header">
                        <h3><i class="fas fa-file-alt"></i> 爬取结果</h3>
                        <div class="result-actions">
                            <button class="btn btn-outline btn-sm" id="copyResultBtn">
                                <i class="fas fa-copy"></i> 复制内容
                            </button>
                            <button class="btn btn-outline btn-sm" id="sendToChatBtn">
                                <i class="fas fa-comments"></i> 发送到对话
                            </button>
                        </div>
                    </div>
                    
                    <div class="result-content">
                        <div class="url-info">
                            <strong>目标网址：</strong> <span id="resultUrl"></span>
                        </div>
                        <div class="markdown-preview">
                            <h4>Markdown内容预览：</h4>
                            <div class="preview-container">
                                <pre><code class="language-markdown" id="markdownContent"></code></pre>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="crawler-info">
                    <div class="info-card">
                        <h4><i class="fas fa-info-circle"></i> 使用说明</h4>
                        <ul>
                            <li>输入有效的网址（以http://或https://开头）</li>
                            <li>系统将使用Firecrawl API进行网页内容抓取</li>
                            <li>抓取结果将转换为Markdown格式显示</li>
                            <li>支持复制内容或发送到对话界面</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="documentation-container" id="documentationTab" style="display: none;">
                <div class="documentation-header">
                    <h2><i class="fas fa-book"></i> Python-100-Days 文档查询</h2>
                    <p>浏览和搜索 Python-100-Days 项目中的所有 Markdown 文档</p>
                    <div class="documentation-search">
                        <input type="text" id="docSearchInput" placeholder="搜索文档内容...">
                        <button id="docSearchBtn">
                            <i class="fas fa-search"></i> 搜索
                        </button>
                    </div>
                </div>
                
                <div class="documentation-content">
                    <div class="doc-sidebar">
                        <h3><i class="fas fa-folder-open"></i> 文档列表</h3>
                        <div class="doc-list" id="docList">
                            <!-- 文档列表将通过JavaScript动态加载 -->
                            <div class="loading-docs">
                                <i class="fas fa-spinner fa-spin"></i> 加载文档列表中...
                            </div>
                        </div>
                    </div>
                    
                    <div class="doc-main">
                        <div class="doc-toolbar">
                            <button class="btn btn-outline btn-sm" id="docBackBtn" style="display: none;">
                                <i class="fas fa-arrow-left"></i> 返回列表
                            </button>
                            <button class="btn btn-outline btn-sm" id="docRefreshBtn">
                                <i class="fas fa-sync-alt"></i> 刷新
                            </button>
                            <div class="doc-path" id="docPath">请选择左侧文档进行查看</div>
                        </div>
                        
                        <div class="doc-viewer" id="docViewer">
                            <div class="welcome-doc">
                                <div class="doc-icon">
                                    <i class="fas fa-book-open"></i>
                                </div>
                                <div class="doc-title">欢迎使用文档查询</div>
                                <div class="doc-subtitle">
                                    从左侧选择 Python-100-Days 项目中的 Markdown 文档进行查看
                                </div>
                                <div class="doc-stats">
                                    <div class="stat-item">
                                        <i class="fas fa-file-alt"></i>
                                        <span id="totalDocs">加载中...</span> 个文档
                                    </div>
                                    <div class="stat-item">
                                        <i class="fas fa-images"></i>
                                        <span id="totalImages">加载中...</span> 张图片
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 移动端底部导航 -->
    <div class="mobile-bottom-nav">
        <div class="nav-item" id="mobileInsertCode">
            <i class="fas fa-code"></i>
            <span>代码</span>
        </div>
        <div class="nav-item" id="mobileExampleQuestions">
            <i class="fas fa-question-circle"></i>
            <span>示例</span>
        </div>
        <div class="nav-item" id="mobileImageUpload">
            <i class="fas fa-image"></i>
            <span>图像</span>
        </div>
    </div>

    <!-- 登录/注册模态框 -->
    <div class="modal-overlay" id="loginModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">登录</h2>
                <button class="modal-close" id="closeModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="auth-tabs">
                    <button class="auth-tab active" id="loginTab">登录</button>
                    <button class="auth-tab" id="registerTab">注册</button>
                </div>
                
                <form id="loginForm" class="auth-form">
                    <div class="form-group">
                        <label for="loginUsername">用户名</label>
                        <input type="text" id="loginUsername" name="username" required minlength="3" maxlength="50">
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">密码</label>
                        <input type="password" id="loginPassword" name="password" required minlength="6">
                    </div>
                    <button type="submit" class="btn btn-primary btn-block">登录</button>
                    <div id="loginError" class="error-message" style="display: none;"></div>
                </form>
                
                <form id="registerForm" class="auth-form" style="display: none;">
                    <div class="form-group">
                        <label for="registerUsername">用户名</label>
                        <input type="text" id="registerUsername" name="username" required minlength="3" maxlength="50">
                    </div>
                    <div class="form-group">
                        <label for="registerPassword">密码</label>
                        <input type="password" id="registerPassword" name="password" required minlength="6">
                    </div>
                    <div class="form-group">
                        <label for="confirmPassword">确认密码</label>
                        <input type="password" id="confirmPassword" name="confirmPassword" required minlength="6">
                    </div>
                    <button type="submit" class="btn btn-primary btn-block">注册</button>
                    <div id="registerError" class="error-message" style="display: none;"></div>
                </form>
            </div>
        </div>
    </div>

    <!-- 图像上传界面 -->
    <div class="image-upload-container" id="imageUploadContainer" style="display: none;">
        <div class="upload-header">
            <h4><i class="fas fa-image"></i> 上传图像</h4>
            <button class="close-upload" id="closeUpload">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="upload-body">
            <div class="upload-area" id="dropArea">
                <i class="fas fa-cloud-upload-alt"></i>
                <p>拖放图像文件到这里，或</p>
                <button class="btn btn-outline" id="browseImageBtn">
                    选择文件
                </button>
                <input type="file" id="imageFileInput" accept="image/*" style="display: none;">
                <p class="upload-hint">支持 PNG, JPG, GIF, BMP, WebP 格式，最大5MB</p>
            </div>
            <div class="preview-container" id="imagePreview" style="display: none;">
                <div class="preview-header">
                    <span>预览</span>
                    <button class="btn btn-sm btn-outline" id="removePreview">
                        <i class="fas fa-trash"></i> 移除
                    </button>
                </div>
                <div class="preview-image">
                    <img id="previewImage" src="" alt="预览图像">
                </div>
                <div class="preview-info">
                    <p id="previewName"></p>
                    <p id="previewSize"></p>
                </div>
            </div>
        </div>
        <div class="upload-footer">
            <button class="btn btn-outline" id="cancelUpload">
                取消
            </button>
            <button class="btn btn-primary" id="confirmUpload" disabled>
                <i class="fas fa-upload"></i> 上传
            </button>
        </div>
    </div>

    <!-- 图像查看模态框 -->
    <div class="image-modal-overlay" id="imageModal" style="display: none;">
        <div class="image-modal-content">
            <div class="modal-header">
                <h3 id="modalImageTitle"></h3>
                <button class="modal-close" onclick="closeImageModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <img id="modalImage" src="" alt="查看图像">
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="downloadModalImage()">
                    <i class="fas fa-download"></i> 下载
                </button>
                <button class="btn btn-outline" onclick="copyModalImage()">
                    <i class="fas fa-copy"></i> 复制
                </button>
                <button class="btn btn-primary" onclick="closeImageModal()">
                    关闭
                </button>
            </div>
        </div>
    </div>

    <!-- 用户信息显示 -->
    <div class="user-info" id="userInfo" style="display: none;">
        <div class="user-name" id="userName"></div>
        <button class="btn btn-outline btn-sm" id="logoutBtn">登出</button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/markdown-it/13.0.1/markdown-it.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"></script>
    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>
